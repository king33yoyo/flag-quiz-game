# 防重复功能测试说明

## 测试目标
验证除挑战模式外的其他游戏模式在一次游戏中不会出现重复的国家。

## 改进的功能

### 1. flag-identify 和 country-select 模式（10题）
- **目标**：10个问题使用10个完全不同的国家作为正确答案
- **机制**：
  - 游戏开始时验证国家池是否足够（至少40个国家）
  - 每个问题的正确答案必须是未使用过的国家
  - 每个问题的所有4个选项都使用不同的国家
  - 游戏期间不清除已使用国家的记录

### 2. timed 模式（60秒）
- **目标**：在时间限制内尽可能减少重复
- **机制**：
  - 当可用国家少于4个时，清除最旧的10个使用记录
  - 保留最近使用的10个国家，确保用户体验连续性
  - 正确答案优先使用未使用的国家
  - 错误答案也尽量避免重复

### 3. challenge 模式
- **保持现有逻辑**：每个国家只作为正确答案出现一次

## 测试方法

### 手动测试步骤：
1. 启动开发服务器：`npm run dev`
2. 测试flag-identify模式：
   - 选择easy难度，World地区
   - 完成10个问题，记录是否有重复的国家
3. 测试country-select模式：
   - 选择medium难度，Asia地区
   - 完成10个问题，记录是否有重复的国家
4. 测试timed模式：
   - 选择hard难度，Europe地区
   - 在60秒内回答尽可能多的问题
   - 观察重复率是否显著降低

### 预期结果：
- ✅ flag-identify模式：10个问题使用10个不同的正确答案
- ✅ country-select模式：10个问题使用10个不同的正确答案
- ✅ timed模式：重复率大幅降低
- ✅ challenge模式：保持原有的严格防重复机制

## 技术实现要点

### 1. 核心改进：`generateRegularQuestion`方法
- 分离了不同模式的防重复策略
- 新增了`manageAvailableCountries`方法管理国家池
- 新增了`selectWrongAnswers`方法确保错误答案不重复
- 新增了`markUsedCountries`方法根据模式标记使用记录

### 2. 模式特定的策略
- **有限题目模式**：严格防重复，所有选项国家都标记为已使用
- **限时模式**：智能清除旧记录，平衡防重复和用户体验
- **挑战模式**：保持现有的专用国家池机制

### 3. 验证机制
- 游戏开始时验证国家池是否足够
- 在控制台输出警告信息如果国家不足
- 提供调试方法查看使用情况

## 代码质量保证
- ✅ TypeScript编译通过
- ✅ 保持了原有接口的兼容性
- ✅ 挑战模式功能完全不受影响
- ✅ 代码结构清晰，易于维护

## 性能考虑
- 使用Set数据结构确保O(1)时间复杂度的查找
- 避免不必要的数组操作
- 只在必要时才清除使用记录
- 预计算验证减少运行时开销